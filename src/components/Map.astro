---
interface Props {
  center?: [number, number];
  zoom?: number;
  height?: string;
}

const {
  center = [-3.725, 50.776], // Default to Yeoford coordinates
  zoom = 14,
  height = '500px'
} = Astro.props;
---

<div id="map" style={`width: 100%; height: ${height}; border-radius: 8px;`}>
</div>

<script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
<link
  href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css"
  rel="stylesheet"
/>

<script define:vars={{ center, zoom }}>
  let map = null;

  function initMap() {
    const container = document.getElementById('map');
    if (!container) {
      // If container doesn't exist yet, try again in a short while
      setTimeout(initMap, 50);
      return;
    }

    if (map) {
      map.remove();
    }

    map = new maplibregl.Map({
      style: 'https://tiles.openfreemap.org/styles/liberty',
      center: center,
      zoom: zoom,
      container: 'map'
    });
  }

  // Initialize on first load
  document.addEventListener('DOMContentLoaded', initMap);

  // Handle view transitions
  document.addEventListener('astro:after-swap', initMap);
</script>
